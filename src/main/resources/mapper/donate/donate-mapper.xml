<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="donate">

	<select id="donateList" resultType="donate">
		SELECT
		B.DONATE_NO d,
		B.DONATE_TITLE,
		CASE
		WHEN TRUNC(SYSDATE) = TRUNC(B.DONATE_END_DATE) THEN 'D-DAY'
		WHEN TRUNC(SYSDATE) <![CDATA[ < ]]>
		TRUNC(B.DONATE_END_DATE) THEN 'D-' || (TRUNC(B.DONATE_END_DATE) -
		TRUNC(SYSDATE))
		ELSE 'D+' || (TRUNC(SYSDATE) - TRUNC(B.DONATE_END_DATE))
		END AS dDay,
		B.DONATE_FOUNDATION,
		NVL((SELECT SUM(I.DONATE_AMOUNT) FROM DONATE_INFO I WHERE I.DONATE_NO =
		B.DONATE_NO ) , 0) DONATE_AMOUNT ,
		ROUND(NVL((SELECT SUM(I.DONATE_AMOUNT) FROM DONATE_INFO I WHERE I.DONATE_NO =
		B.DONATE_NO ) , 0)/B.DONATE_HOPE*100) donateProgress
		FROM
		(SELECT *
		FROM DONATE_BOARD
		ORDER BY DONATE_NO DESC) B
	</select>

	<select id="donateDetail" resultType="donate">
		SELECT B.DONATE_NO,
		B.DONATE_TITLE,
		NVL((SELECT SUM(I.DONATE_AMOUNT) FROM DONATE_INFO I WHERE I.DONATE_NO =
		B.DONATE_NO ), 0) AS DONATE_AMOUNT,
		B.DONATE_HOPE,
		ROUND(NVL((SELECT SUM(I.DONATE_AMOUNT) FROM DONATE_INFO I WHERE I.DONATE_NO =
		B.DONATE_NO ), 0) / B.DONATE_HOPE * 100) AS DONATE_AVG,
		(SELECT COUNT(USER_NO) FROM DONATE_INFO WHERE DONATE_NO = B.DONATE_NO) AS
		USER_COUNT,
		CASE
		WHEN TRUNC(SYSDATE) = TRUNC(B.DONATE_END_DATE) THEN 'D-DAY'
		WHEN TRUNC(SYSDATE) <![CDATA[ < ]]> TRUNC(B.DONATE_END_DATE) THEN 'D-' ||
		(TRUNC(B.DONATE_END_DATE) - TRUNC(SYSDATE))
		ELSE 'D+' || (TRUNC(SYSDATE) - TRUNC(B.DONATE_END_DATE))
		END AS dDay,
		B.DONATE_CONTENT
		FROM DONATE_BOARD B
		WHERE B.DONATE_NO = #{donateNo}
	</select>

</mapper>